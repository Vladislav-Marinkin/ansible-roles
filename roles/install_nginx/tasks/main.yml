---
# ====================================================
# üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –¥–ª—è nginx
# ====================================================
- name: Create nginx group
  group:
    name: "{{ nginx_group }}"
    state: present

# ====================================================
# üßë‚Äçüíª –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è nginx
# ====================================================
- name: Create nginx user
  user:
    name: "{{ nginx_user }}"
    group: "{{ nginx_group }}"
    state: present

# ====================================================
# üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx
# ====================================================
- name: Install nginx
  package:
    name: nginx
    state: present
  notify: Start service

# ====================================================
# üîô –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx
# ====================================================
- name: Backup nginx.conf
  copy:
    src: /etc/nginx/nginx.conf
    dest: /etc/nginx/nginx.conf.backup
    mode: '0644'
    remote_src: yes

# ====================================================
# üìù –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx –∏–∑ —à–∞–±–ª–æ–Ω–∞
# ====================================================
- name: Creating nginx configuration
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
  notify: Reload nginx