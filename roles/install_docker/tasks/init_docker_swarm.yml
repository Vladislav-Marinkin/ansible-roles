---
# ===========================================
# üõ†Ô∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Docker Swarm –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–µ
# ===========================================

# üîπ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Docker Swarm, —É–∫–∞–∑—ã–≤–∞—è —Ç–µ–∫—É—â–∏–π IP-–∞–¥—Ä–µ—Å –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–∫–ª–∞–º–∏—Ä—É–µ–º–æ–≥–æ
- name: Initialize Docker Swarm
  shell: docker swarm init --advertise-addr {{ ansible_default_ipv4.address }}
  ignore_errors: true  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ Swarm —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

# üîë –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö —É–∑–ª–æ–≤ (worker)
- name: Get manager token
  shell: docker swarm join-token -q worker
  register: worker_token  # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

# üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- name: Save worker token
  set_fact:
    swarm_worker_token: "{{ worker_token.stdout }}"
    swarm_manager_host: "{{ hostvars[inventory_hostname].ansible_hostname }}"
  loop: "{{ groups['all'] }}"
  run_once: true