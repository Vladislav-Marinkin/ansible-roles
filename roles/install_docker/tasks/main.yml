---
# ============================================================
# üö®  –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Playbook –ø—Ä–∏ `skip_playbook: true`
# ============================================================

- name: Show skip message
  debug:
    msg: "üö® Playbook execution is disabled by `skip_playbook`. Exiting..."
  run_once: true
  when: skip_playbook | default(false)

- name: Stop execution if `skip_playbook` is enabled
  meta: end_play
  when: skip_playbook | default(false)

# ======================================
# üìÇ 1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
# ======================================

- name: Include variables
  include_vars: vars/docker.yml

# ==============================
# üê≥ 2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
# ==============================

# üîπ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –≤ `defaults` –∏ —Ö–æ—Å—Ç –æ—Ç–º–µ—á–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏
- name: Install Docker
  include_tasks: install_docker.yml
  when: hostvars[inventory_hostname].get('docker', false)

# üîπ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker Swarm, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –≤ `defaults` –∏ —Ö–æ—Å—Ç –æ—Ç–º–µ—á–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏
- name: Install Docker Swarm
  include_tasks: install_docker_swarm.yml
  when: 
    - install_docker_swarm | default(false)
    - hostvars[inventory_hostname].get('docker-swarm', false)

# ==============================
# üêã 3Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Portainer
# ==============================

# üîπ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Portainer –Ω–∞ –≤–µ–± —Å–µ—Ä–≤–µ—Ä
- name: Install Portainer
  include_tasks: install_portainer.yml
  when: hostvars[inventory_hostname].get('docker', false)

# üîπ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Portainer agent
#- name: Install Portainer
#  include_tasks: install_portainer_agent.yml
#  when: 
#    - install_docker_swarm | default(false)
#    - hostvars[inventory_hostname].get('docker-swarm', false)

# üîπ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ –∫ Portainer
#- name: Install Portainer
#  include_tasks: connecting_portainer_agents.yml
#  when: 
#    - hostvars[inventory_hostname].get('docker', false)
#    - hostvars[inventory_hostname].get('docker-swarm', false)