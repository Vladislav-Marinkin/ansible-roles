---
# =================================================
# üîó 1Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Docker
# =================================================

- name: Include Docker repository setup tasks
  include_tasks: docker_repo.yml

# ======================================
# üê≥ 2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
# ======================================

# üöÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker –∏ –µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (RedHat)
- name: Install Docker for RedHat family
  yum:
    name:
      - "docker-ce"
      - "docker-ce-cli"
      - containerd.io
    state: present
  when: ansible_os_family == "RedHat"

# üöÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker –∏ –µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Debian)
- name: Install Docker for Debian family
  apt:
    name:
      - "docker-ce"
      - "docker-ce-cli"
      - containerd.io
    state: present
    update_cache: yes
  when: ansible_os_family == "Debian"

# ======================================
# ‚öôÔ∏è 3Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ Docker
# ======================================

# üîÑ –í–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ Docker –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ
- name: Enable and start Docker service
  systemd:
    name: docker
    state: restarted
    enabled: yes

# ===============================================
# üë§ 4Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—É Docker
# ===============================================

# üë• –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—É Docker, —á—Ç–æ–±—ã –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ sudo
- name: Add users to docker group
  user:
    name: "{{ item }}"
    groups: docker
    append: yes
  with_items: "{{ docker_settings.users }}"

# ======================================
# üõ†Ô∏è 5Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
# ======================================

- name: Install docker-compose
  include_tasks: install_docker_compose.yml