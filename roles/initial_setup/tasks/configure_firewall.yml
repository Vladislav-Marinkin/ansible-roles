# =====================================================
# üìå 1Ô∏è‚É£ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ –ø–æ—Ä—Ç–æ–≤ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Ñ–∞–π–ª–∞
# =====================================================
- name: Load port mapping variables
  include_vars: vars/ports.yml  # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Ä—Ç–æ–≤ –∏ –∏—Ö SELinux-—Ç–∏–ø—ã

- name: Load SSH configuration variables
  include_vars: vars/ssh.yml  # –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH (port, PermitRootLogin, PasswordAuthentication)


# =====================================================
# üîê 2Ô∏è‚É£ –†–∞–∑—Ä–µ—à–∞–µ–º —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã –≤ SELinux
# =====================================================
- name: Allow required ports in SELinux
  community.general.seport:
    ports: "{{ item }}"
    proto: tcp
    setype: "{{ port_type_map[item] | default(port_type_map['default']) }}"
    state: present
  loop: "{{ allow_ports | default([]) }}"
  when: selinux | bool

# =====================================================
# üî• 3Ô∏è‚É£ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç—ã –≤ Firewalld (TCP)
# =====================================================
- name: Ensure required TCP ports are open in Firewalld
  firewalld:
    port: "{{ item }}/tcp"
    permanent: yes
    state: enabled
  loop: "{{ allow_ports | default([]) }}"
  when: firewalld_active | bool
  notify: Reload Firewalld

# =====================================================
# üî• 4Ô∏è‚É£ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç—ã –≤ Firewalld (UDP)
# =====================================================
- name: Ensure required UDP ports are open in Firewalld
  firewalld:
    port: "{{ item }}/udp"
    permanent: yes
    state: enabled
  loop: "{{ allow_ports | default([]) }}"
  when: firewalld_active | bool
  notify: Reload Firewalld

# =====================================================
# üîì 5Ô∏è‚É£ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç—ã –≤ UFW (TCP)
# =====================================================
- name: Ensure required ports are open in UFW
  ufw:
    rule: allow
    port: "{{ item }}"
    proto: tcp
  loop: "{{ allow_ports | default([]) }}"
  when: ufw_active | bool
  notify: Reload UFW

# =====================================================
# üîì 6Ô∏è‚É£ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç—ã –≤ UFW (UDP)
# =====================================================
- name: Ensure required ports are open in UFW
  ufw:
    rule: allow
    port: "{{ item }}"
    proto: udp
  loop: "{{ allow_ports | default([]) }}"
  when: ufw_active | bool
  notify: Reload UFW