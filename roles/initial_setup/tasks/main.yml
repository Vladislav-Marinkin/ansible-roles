---
# ============================================================
# üö®  –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Playbook –ø—Ä–∏ `skip_playbook: true`
# ============================================================
- name: Show skip message
  debug:
    msg: "üö® Playbook execution is disabled by `skip_playbook`. Exiting..."
  run_once: true
  when: skip_playbook | default(false)

- name: Stop execution if `skip_playbook` is enabled
  meta: end_play
  when: skip_playbook | default(false)

# =====================================
# 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π
# =====================================
- name: Run system checks
  include_tasks: check_system.yml

# ==========================================
# 2Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ—Ä—Ç–æ–≤ (Firewall)
# ==========================================
- name: Ensure required ports are open
  include_tasks: configure_firewall.yml
  when: allow_ports | default([]) | length > 0  # –í—ã–ø–æ–ª–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –ø–æ—Ä—Ç—ã

# ==============================
# 3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ hostname
# ==============================
- name: Change hostnames to local host
  include_tasks: configure_hostnames_local.yml
  when: "'new_servers' in group_names and change_hostnames"

- name: Change hostnames to remote hosts
  include_tasks: configure_hostnames_remote.yml
  when: "'new_servers' not in group_names and change_hostnames"

# ==============================
# 4Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# ==============================
- name: Include tasks for users creation
  include_tasks: create_users.yml
  when: user_created

# ==============================
# 5Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH
# ==============================
- name: Configure ssh
  include_tasks: configure_ssh.yml
  when: edit_ssh_settings

# ==============================
# 6Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
# ==============================
- name: Update system
  include_tasks: update_system.yml
  when: upgrade_system
