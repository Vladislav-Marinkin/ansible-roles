---
# ======================================
# üîç 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Firewalld
# ======================================
- name: Check if firewalld is running
  command: systemctl is-active firewalld
  register: firewalld_status
  changed_when: false
  ignore_errors: true

# ======================================
# üîç 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è UFW 
# ======================================
- name: Check if ufw is running
  shell: "ufw status | grep -w Status | awk '{ print $2 }'"
  register: ufw_status
  changed_when: false
  ignore_errors: true

# ======================================
# üîç 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è SELinux
# ======================================
- name: Check if SELinux is enabled
  command: getenforce
  register: selinux_status
  changed_when: false
  ignore_errors: true

# ======================================
# ‚úÖ 4Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤
# ======================================
- name: Set system facts
  set_fact:
    firewalld_active: "{{ firewalld_status.stdout == 'active' }}"
    ufw_active: "{{ ufw_status.stdout == 'active' }}"
    selinux: "{{ selinux_status.stdout == 'Enforcing' }}"

# ======================================
# üîç 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Python
# ======================================
- name: Check if Python is installed
  raw: "command -v python3 || command -v python"
  register: python_check
  changed_when: false
  ignore_errors: true

# ======================================
# ‚úÖ 5Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤
# ======================================
- name: Set system facts
  set_fact:
    firewalld_active: "{{ firewalld_status.stdout == 'active' }}"
    ufw_active: "{{ ufw_status.stdout == 'active' }}"
    selinux: "{{ selinux_status.stdout == 'Enforcing' }}"
    python_installed: "{{ python_check.stdout != '' }}"