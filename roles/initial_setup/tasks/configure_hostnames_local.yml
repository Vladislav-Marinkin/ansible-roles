---
# ======================================
# üñ•Ô∏è 1Ô∏è‚É£ –ò–∑–º–µ–Ω–µ–Ω–∏–µ hostname –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö–æ—Å—Ç–µ
# ======================================
- name: Change hostname
  ansible.builtin.hostname:
    name: "{{ hostvars[inventory_hostname]['hostname'] }}"

# ======================================
# üîç 2Ô∏è‚É£ –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
# ======================================
- name: Collect remote host details
  ansible.builtin.setup:
  delegate_to: "{{ item }}"
  delegate_facts: true
  loop: "{{ groups['reachable_hosts'] }}"

# ======================================
# üìù 3Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ /etc/hosts –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö–æ—Å—Ç–µ
# ======================================
- name: Ensure correct IP and hostname in /etc/hosts to local host
  ansible.builtin.lineinfile:
    path: /etc/hosts
    regexp: "^.*\\s+{{ hostvars[item]['hostname'] }}$"
    line: "{{ hostvars[item]['ansible_default_ipv4']['address'] }} {{ hostvars[item]['hostname'] }}"
    state: present
    backup: yes
  delegate_to: localhost
  loop: "{{ groups['reachable_hosts'] }}"
